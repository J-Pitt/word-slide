<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Crosslide</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#4CAF50">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Crosslide">
  <link rel="apple-touch-icon" href="/icon.svg">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/icon.svg">
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
            
            // Listen for updates
            registration.addEventListener('updatefound', () => {
              console.log('New service worker version found!');
            });
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
          
        // Listen for messages from service worker
        navigator.serviceWorker.addEventListener('message', (event) => {
          const { type, message, version } = event.data;
          
          if (type === 'SW_UPDATE_READY') {
            console.log(`Update ready: ${message} (v${version})`);
            showUpdateNotification(message, version);
          } else if (type === 'SW_UPDATED') {
            console.log(`Updated: ${message} (v${version})`);
            showSuccessNotification(message, version);
          }
        });
        
        // Handle controller change (when new SW takes control)
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('App updated! Reloading...');
          // Optional: Auto-reload after a short delay
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        });
      });
    }
    
    // Show update notification
    function showUpdateNotification(message, version) {
      // Create a simple notification banner
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        font-family: Arial, sans-serif;
        font-size: 14px;
        max-width: 300px;
        animation: slideIn 0.3s ease-out;
      `;
      notification.innerHTML = `
        <div style="font-weight: bold; margin-bottom: 5px;">ðŸš€ App Update Available!</div>
        <div style="font-size: 12px; opacity: 0.9;">${message}</div>
      `;
      
      document.body.appendChild(notification);
      
      // Remove after 5 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in forwards';
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }
    
    // Show success notification
    function showSuccessNotification(message, version) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #2196F3, #1976D2);
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        font-family: Arial, sans-serif;
        font-size: 14px;
        max-width: 300px;
        animation: slideIn 0.3s ease-out;
      `;
      notification.innerHTML = `
        <div style="font-weight: bold; margin-bottom: 5px;">âœ… Updated Successfully!</div>
        <div style="font-size: 12px; opacity: 0.9;">Version ${version} is now active</div>
      `;
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in forwards';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>